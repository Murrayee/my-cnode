{"version":3,"sources":["webpack:///./public/components/HomePage/HomePage.js?6bc8"],"names":["HomePage","props","displayName","state","isFreshing","fixedTop","scrollT","tabs","title","filter","onRefresh","next","setState","fresh","setTimeout","selectedTab","dispatch","handleClick","tab","tabData","ua","navigator","userAgent","indexOf","loadMore","page","isFetching","ipage","newProps","topics","length","window","scrollTo","map","index","opacity","lastScrollY","onscroll","windowH","contentH","diff","Component","mapStateToProps","homePage"],"mappings":"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","file":"0.479f27780c5772063c1c.hot-update.js","sourcesContent":["/**\r\n * Created by Administrator on 2017/2/14.\r\n */\r\nimport React, {Component, PropTypes}  from \"react\";\r\nimport {render} from \"react-dom\";\r\nimport {Link} from 'react-router'\r\nimport {selectTab, fetchTopics, recordScrollT} from '../../actions/actions'\r\nimport CircleLoading from \"../Common/CircleLoading/CircleLoading\"\r\nimport {connect} from 'react-redux'\r\nimport Header from \"../Common/Header/Header\"\r\nimport Lists from \"../Common/Lists/Lists\"\r\nimport getSize from \"../../utils/getSize\"\r\nclass HomePage extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.displayName = \"HomePage\";\r\n        this.state = {\r\n            isFreshing: false,\r\n            fixedTop:0,\r\n            scrollT:0\r\n        };\r\n        this.tabs = [\r\n            {\r\n                title: '全部',\r\n                filter: 'all',\r\n            },\r\n            {\r\n                title: '精华',\r\n                filter: 'good',\r\n            },\r\n            {\r\n                title: '分享',\r\n                filter: 'share',\r\n            },\r\n            {\r\n                title: '问答',\r\n                filter: 'ask',\r\n            },\r\n            {\r\n                title: '招聘',\r\n                filter: 'job',\r\n            }\r\n        ];\r\n        this.onRefresh=(next)=>{\r\n            if(!this.state.isFreshing){\r\n                this.setState({\r\n                    isFreshing:true\r\n                });\r\n                this.fresh();\r\n                setTimeout(_ => {\r\n                    next();\r\n                    this.setState({\r\n                        isFreshing:false\r\n                    })\r\n                },3000)\r\n            }\r\n\r\n        };\r\n        this.fresh=()=>{\r\n            const {selectedTab,dispatch} = this.props;\r\n            dispatch(fetchTopics(selectedTab,1));\r\n        };\r\n        this.handleClick = (tab) => {\r\n            let {scrollT} = getSize();\r\n            const {selectedTab,dispatch,tabData} = this.props;\r\n            dispatch(recordScrollT(selectedTab,scrollT));\r\n            dispatch(selectTab(tab));\r\n            const ua = navigator.userAgent;\r\n            if(!tabData[tab] && ua.indexOf('Mobile') === -1){\r\n                if(scrollT >= 64){\r\n                    dispatch(recordScrollT(tab,64))\r\n                    this.setState({\r\n                        scrollT:64\r\n                    })\r\n                }else{\r\n                    dispatch(recordScrollT(tab,scrollT));\r\n                    this.setState({\r\n                        scrollT:scrollT\r\n                    })\r\n                }\r\n            }\r\n        };\r\n        this.loadMore = () => {\r\n            const {selectedTab, page, isFetching, dispatch} = this.props;\r\n            let ipage = page;\r\n            if (!isFetching) {\r\n                dispatch(fetchTopics(selectedTab, ++ipage));\r\n            }\r\n        };\r\n    }\r\n\r\n    componentWillReceiveProps(newProps) {\r\n        const {topics,isFetching,selectedTab,scrollT,dispatch} = newProps;\r\n        // 去除刷新时记住的滚动条位置\r\n        if(topics.length === 0 && this.props.scrollT === 0){\r\n            window.scrollTo(0,0)\r\n        }\r\n        // fetchTopics开始后会先发送一个request的action,这个ation也会改变state从而触发该方法。如果不对isFetching进行判断，会再次进行fetchTopics从而进行了不必要的重复数据请求\r\n        if (!isFetching && topics.length === 0) {\r\n            dispatch(fetchTopics(selectedTab));\r\n        }\r\n        if(selectedTab !== this.props.selectedTab){\r\n            if(scrollT){\r\n                window.scrollTo(0,scrollT)\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n        const {selectedTab,isFetching,page,topics,dispatch,tabData} = this.props;\r\n        // console.log(this.props)\r\n        return (\r\n            <div>\r\n                <Header tabs={this.tabs} filter={selectedTab} onClick={this.handleClick}>\r\n                    {this.tabs.map((tab, index) =>\r\n                        <div key={index}>\r\n                            {/*{((isFetching&&page === 0)||(tab.filter!==selectedTab&&!tabData[tab.filter])) && <CircleLoading />}*/}\r\n                            {tab.filter === selectedTab && <div style={{opacity: (!isFetching || page >= 1) ? 1 : 0}}>\r\n                                <Lists topics={topics} dispatch={dispatch} isFetching={isFetching}/>\r\n                            </div>}\r\n                        </div>\r\n                    )}\r\n                </Header>\r\n            </div>\r\n        )\r\n    }\r\n    componentDidMount(){\r\n        const {selectedTab,page,scrollT,dispatch} = this.props;\r\n        if(page === 0){\r\n            dispatch(fetchTopics(selectedTab));\r\n        }\r\n        if(scrollT){\r\n            window.scrollTo(0,scrollT);\r\n        }\r\n        let lastScrollY = this.lastScrollY;\r\n\r\n        window.onscroll = () => {\r\n            let {windowH,contentH,scrollT} = getSize()\r\n            if(windowH + scrollT + 100 > contentH){\r\n                this.loadMore()\r\n            }\r\n            const ua = navigator.userAgent;\r\n            if(ua.indexOf('Mobile') === -1 ){\r\n                if(!lastScrollY || !scrollT){\r\n                    lastScrollY = scrollT\r\n                }\r\n                let diff = scrollT - lastScrollY;\r\n                if(diff >= 0){\r\n                    if(scrollT > 64 && this.state.fixedTop!==64){\r\n                        this.setState({\r\n                            fixedTop:64\r\n                        })\r\n                    }\r\n                    if(scrollT <= 64){\r\n                        this.setState({\r\n                            fixedTop:scrollT\r\n                        })\r\n                    }\r\n                }else{\r\n                    this.setState({\r\n                        scrollT:0\r\n                    })\r\n                    if(scrollT > 64 && this.state.fixedTop!==0){\r\n                        this.setState({\r\n                            fixedTop:0\r\n                        })\r\n                    }\r\n                }\r\n                lastScrollY = scrollT\r\n            }\r\n        };\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        let {windowH,contentH,scrollT} = getSize();\r\n        const {topics} = this.props;\r\n        // 第一次切换到没有加载数据的tab时，在willReceiveProp中已经将页面滚动了一定距离，在render中打印scrollT也不为0\r\n        // 但是一进入这个函数scrollT就变为0,而且也未触发onscroll事件（问题待解决），所以目前只能去重新判断这种情况\r\n        if(scrollT===0 && this.state.scrollT > 0){\r\n            window.scrollTo(0,this.state.scrollT)\r\n        }\r\n\r\n        // 判断内容加载后，内容的高度是否填满屏幕，若网页太高，加载一次内容的高度不能填满整个网页，则继续请求数据\r\n        if(topics.length>0 && windowH + 200 > contentH ){\r\n            this.loadMore();\r\n        }\r\n        // console.log('componentDidUpdate',getSize().scrollT)\r\n    }\r\n    componentWillUnmount(){\r\n        let {scrollT} = getSize();\r\n        const {selectedTab,dispatch} = this.props;\r\n        dispatch(recordScrollT(selectedTab,scrollT));\r\n        // 必须解绑事件，否则当组件再次被加载时，该事件会监听两个组件\r\n        window.onscroll = null;\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    const {homePage} = state;\r\n    const {selectedTab, tabData} = homePage;\r\n    const {isFetching, page, scrollT, topics} = tabData[selectedTab] || {\r\n        isFetching: false,\r\n        page: 0,\r\n        scrollT: 0,\r\n        topics: []\r\n    };\r\n\r\n    // 当组件第一次render时,还未进行任何action,初始化的state里没有tabData[selectedTab]，所以这里需要初始化\r\n    return {selectedTab, tabData, isFetching, page, scrollT, topics}\r\n}\r\nexport default connect(mapStateToProps)(HomePage)\r\n\n\n\n// WEBPACK FOOTER //\n// ./public/components/HomePage/HomePage.js"],"sourceRoot":""}